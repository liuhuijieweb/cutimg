!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("cut_img",[],e):"object"==typeof exports?exports.cut_img=e():t.cut_img=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(r){if(i[r])return i[r].exports;var o=i[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="./dist/",e(e.s=1)}([function(t,e,i){"use strict";e.a={name:"cutimg",data:function(){return{img:null,$srcImg:null,$resImg:null,$input:null,$imgContainer:null,$preContainer:null,nw:0,nh:0,clipData:null,ratio:1.6,imgSize:{w:0,h:0},containerTop:0,rec:{w:0,h:0,l:0,t:0},pl:0,pt:0,action:"",actionPoint:{x:0,y:0},referPoint:{x:0,y:0},$rec:null}},computed:{showBox:function(){return this.rec.w&&this.rec.h},imgStyle:function(){return"width:"+this.imgSize.w+"px;height:"+this.imgSize.h+"px;top:"+-this.rec.t+"px;left:"+-this.rec.l+"px;"},recStyle:function(){return"width:"+this.rec.w+"px;height:"+this.rec.h+"px;left:"+this.rec.l+"px;top:"+this.rec.t+"px;"},leftStyle:function(){return"width:"+(this.rec.w-12)+"px;"},rightStyle:function(){return"height:"+(this.rec.h-12)+"px;"}},mounted:function(){this.$input=this.$el.querySelectorAll("#file_input")[0],this.$srcImg=this.$el.querySelectorAll("#clip_src_img")[0],this.$resImg=this.$el.querySelectorAll("#clip_res_img")[0],this.$imgContainer=this.$el.querySelectorAll(".img-container")[0],this.$preContainer=this.$el.querySelectorAll(".pre-container")[0],this.$containerBox=this.$el.querySelectorAll(".container-bg")[0],window.addEventListener("mouseup",this.disableDrag),window.addEventListener("mousemove",this.updateRec)},beforeDestroy:function(){window.removeEventListener("mouseup",this.disableDrag),window.removeEventListener("mousemove",this.updateRec)},methods:{getLeft:function(t){for(var e=t.offsetLeft,i=t.offsetParent;i;)e+=i.offsetLeft,i=i.offsetParent;return e},getTop:function(t){for(var e=t.offsetTop,i=t.offsetParent;i;)e+=i.offsetTop,i=i.offsetParent;return e},initAction:function(t,e,i){this.action=t,this.pl=this.getLeft(this.$refs.box),this.pt=this.getTop(this.$refs.box),this.actionPoint={x:e,y:i},this.referPoint={x:this.rec.l,y:this.rec.t},"drag-lt"===t?this.referPoint={x:this.rec.l+this.rec.w,y:this.rec.t+this.rec.h}:"drag-lb"===t?this.referPoint={x:this.rec.l+this.rec.w,y:this.rec.t}:"drag-rt"===t?this.referPoint={x:this.rec.l,y:this.rec.t+this.rec.h}:"drag-rb"===t?this.referPoint={x:this.rec.l,y:this.rec.t}:"drag-t"===t?this.referPoint={x:this.rec.l,y:this.rec.t+this.rec.h}:"drag-r"===t?this.referPoint={x:this.rec.l,y:this.rec.t}:"drag-b"===t?this.referPoint={x:this.rec.l,y:this.rec.t}:"drag-l"===t&&(this.referPoint={x:this.rec.l+this.rec.w,y:this.rec.t})},pointMouseDown:function(t,e){this.initAction(t,e.pageX,e.pageY),e.preventDefault(),e.stopPropagation()},boxMouseDown:function(t){this.initAction("move",t.pageX,t.pageY),t.preventDefault(),t.stopPropagation()},disableDrag:function(){this.action&&(this.action="")},clearRec:function(){this.action="",this.rec={w:0,h:0,l:0,t:0}},updateRec:function(t){if(this.action){var e=this.$refs.box.offsetWidth,i=this.$refs.box.offsetHeight,r=t.pageX-this.actionPoint.x,o=t.pageY-this.actionPoint.y,s=t.pageX,n=t.pageY,a=0,c=0,h=0,d=0;if(0!==r||0!==o){if("move"===this.action)h=o+this.referPoint.y,d=r+this.referPoint.x,h<=0?h=0:h+this.rec.h>=i&&(h=i-this.rec.h),d<=0?d=0:d+this.rec.w>=e&&(d=e-this.rec.w),this.rec.l=d,this.rec.t=h;else if("cross"===this.action)r>0&&o>0?(a=r+this.rec.l>=e?e-this.rec.l:r,c=a/this.ratio,c+this.rec.t>i&&(c=i-this.rec.t,a=c*this.ratio),this.rec.w=a,this.rec.h=c):r>0&&o<0?(a=r+this.referPoint.x>=e?e-this.referPoint.x:r,c=a/this.ratio,c>=this.referPoint.y&&(c=this.referPoint.y,a=c*this.ratio),this.rec.t=this.referPoint.y-c,this.rec.w=a,this.rec.h=c):r<0&&o<0?(a=r+this.referPoint.x<=0?this.referPoint.x:-r,c=a/this.ratio,c>=this.referPoint.y&&(c=this.referPoint.y,a=c*this.ratio),this.rec.t=this.referPoint.y-c,this.rec.l=this.referPoint.x-a,this.rec.w=a,this.rec.h=c):r<0&&o>0&&(a=r+this.referPoint.x<=0?this.referPoint.x:-r,c=a/this.ratio,c+this.referPoint.y>=i&&(c=i-this.referPoint.y,a=c*this.ratio),this.rec.l=this.referPoint.x-a,this.rec.w=a,this.rec.h=c);else if("drag-lt"===this.action||"drag-rt"===this.action||"drag-lb"===this.action||"drag-rb"===this.action)a=s-(this.referPoint.x+this.pl),c=n-(this.referPoint.y+this.pt),a<0&&c<0?(a=-1*a>=this.referPoint.x?this.referPoint.x:-1*a,c=a/this.ratio,c>=this.referPoint.y&&(c=this.referPoint.y,a=c*this.ratio),this.rec.l=this.referPoint.x-a,this.rec.t=this.referPoint.y-c):a<0&&c>0?(a=-1*a>=this.referPoint.x?this.referPoint.x:-1*a,c=a/this.ratio,c>=i-this.referPoint.y&&(c=i-this.referPoint.y,a=c*this.ratio),this.rec.l=this.referPoint.x-a,this.rec.t=this.referPoint.y):a>0&&c<0?(a=a>=e-this.referPoint.x?e-this.referPoint.x:a,c=a/this.ratio,c>=this.referPoint.y&&(c=this.referPoint.y,a=c*this.ratio),this.rec.l=this.referPoint.x,this.rec.t=this.referPoint.y-c):a>0&&c>0&&(a=a>=e-this.referPoint.x?e-this.referPoint.x:a,c=a/this.ratio,c>=i-this.referPoint.y&&(c=i-this.referPoint.y,a=c*this.ratio),this.rec.l=this.referPoint.x,this.rec.t=this.referPoint.y),this.rec.w=a,this.rec.h=c;else if("drag-t"===this.action){if(c=n-(this.referPoint.y+this.pt),(c=-1*c>=this.referPoint.y?this.referPoint.y:-1*c)<=10)return;this.rec.l=this.referPoint.x,this.rec.t=this.referPoint.y-c,this.rec.h=c,this.ratio=this.rec.w/this.rec.h}else if("drag-b"===this.action){if(c=n-(this.referPoint.y+this.pt),(c=c>=i-this.referPoint.y?i-this.referPoint.y:c)<=10)return;this.rec.l=this.referPoint.x,this.rec.t=this.referPoint.y,this.rec.h=c,this.ratio=this.rec.w/this.rec.h}else if("drag-l"===this.action){if(a=s-(this.referPoint.x+this.pl),(a=-1*a>=this.referPoint.x?this.referPoint.x:-1*a)<=10)return;this.rec.l=this.referPoint.x-a,this.rec.t=this.referPoint.y,this.rec.w=a,this.ratio=this.rec.w/this.rec.h}else if("drag-r"===this.action){if(a=s-(this.referPoint.x+this.pl),(a=a>=e-this.referPoint.x?e-this.referPoint.x:a)<=10)return;this.rec.l=this.referPoint.x,this.rec.t=this.referPoint.y,this.rec.w=a,this.ratio=this.rec.w/this.rec.h}this.selectChange()}}},selectChange:function(){var t=this.rec;t.w>0&&t.h>0&&this.updatePreview()},fileChange:function(){var t=this,e=new FileReader;e.onloadend=function(){t.img=e.result},this.$input.files&&this.$input.files[0]&&e.readAsDataURL(this.$input.files[0])},srcImgLoaded:function(){this.nw=this.$srcImg.naturalWidth,this.nh=this.$srcImg.naturalHeight,this.clearSelect(),this.setImgSize(),this.updatePreview()},clearSelect:function(){this.clearRec(),this.clipData=null},setImgSize:function(){var t=this.nw/this.nh,e=this.$containerBox.offsetWidth,i=this.$containerBox.offsetHeight,r=0,o=0;t>=this.ratio?(this.imgSize.w=e,this.imgSize.h=e/t,this.containerTop=(i-this.imgSize.h)/2,o=this.imgSize.h,r=o*this.ratio):(this.imgSize.h=i,this.imgSize.w=i*t,this.containerTop=0,r=this.imgSize.w,o=r/this.ratio),this.$srcImg.setAttribute("style","width:"+this.imgSize.w+"px;height:"+this.imgSize.h+"px;"),this.$imgContainer.setAttribute("style","width:"+this.imgSize.w+"px;height:"+this.imgSize.h+"px;top:"+this.containerTop+"px;"),this.rec={w:r,h:o,l:0,t:0}},getComputedRec:function(t){var e=this.$imgContainer.offsetWidth,i=this.$imgContainer.offsetHeight,r=e/this.nw,o=i/this.nh;return{l:t.l/r,t:t.t/o,w:t.w/r,h:t.h/o}},updatePreview:function(){var t=this.rec,e=this.$preContainer.offsetWidth,i=this.$preContainer.offsetHeight,r=e/t.w,o=i/t.h,s=r*this.$imgContainer.offsetWidth,n=o*this.$imgContainer.offsetHeight,a=-t.l*r,c=-t.t*o;this.$resImg.setAttribute("style","width:"+s+"px;height:"+n+"px;top:"+c+"px;left:"+a+"px;")},clip:function(){var t=this.rec;if(t.w&&t.h){var e=document.createElement("canvas"),i=e.getContext("2d"),r=this.getComputedRec(t);e.width=r.w,e.height=r.h,i.drawImage(this.$srcImg,-r.l,-r.t,this.nw,this.nh),this.clipData=e.toDataURL("image/jpeg",1)}}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(2),o={install:function(t,e){t.component(r.a.name,r.a)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(o),e.default=o},function(t,e,i){"use strict";function r(t){i(3)}var o=i(0),s=i(9),n=i(8),a=r,c=n(o.a,s.a,!1,a,"data-v-c586d1c0",null);e.a=c.exports},function(t,e,i){var r=i(4);"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);i(6)("1b600635",r,!0,{})},function(t,e,i){e=t.exports=i(5)(!1),e.push([t.i,'.cropper-modal .modal[data-v-c586d1c0]{width:840px;height:524px;background-color:#fff}.modal-content[data-v-c586d1c0]{padding:30px 40px 40px}.img-clip-wrap[data-v-c586d1c0]{width:500px;height:330px;border-right:1px solid #e5e9ef;float:left}.container-bg[data-v-c586d1c0]{width:480px;height:300px;background-color:#000;border-radius:4px}.img-container[data-v-c586d1c0]{position:relative;height:0;margin:auto}.img-container img[data-v-c586d1c0]{position:relative;width:100%;height:100%}.img-container .shadow-box[data-v-c586d1c0]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:1}.reset-img[data-v-c586d1c0]{position:relative;display:inline-block;margin-top:16px;color:#6d757a;font-size:12px;cursor:pointer;overflow:hidden}.reset-img input[data-v-c586d1c0]{position:absolute;font-size:100px;right:0;top:0;opacity:0;cursor:pointer}.reset-img[data-v-c586d1c0]:hover{color:#00b5e5}.img-preview-wrap[data-v-c586d1c0]{width:240px;float:right}.pre-container[data-v-c586d1c0]{width:240px;height:150px;background-color:#000;overflow:hidden;border-radius:4px}.pre-container img[data-v-c586d1c0]{position:relative;width:100%;height:100%;border-radius:4px}.clearfix[data-v-c586d1c0]:after,.clearfix[data-v-c586d1c0]:before{content:" ";display:table}.clearfix[data-v-c586d1c0]:after{clear:both}.modal-footer[data-v-c586d1c0]{text-align:center}.modal-btn[data-v-c586d1c0]{display:inline-block;width:110px;height:32px;font-size:14px;line-height:32px;border-radius:4px;cursor:pointer;text-decoration:none}.btn-confirm[data-v-c586d1c0]{border:1px solid #00a1d6;color:#fff;background-color:#00a1d6}.btn-confirm[data-v-c586d1c0]:hover{background-color:#00b5e5}.crop-wrap[data-v-c586d1c0]{width:100%;height:100%;position:absolute;top:0;left:0;z-index:10;cursor:crosshair}.crop-box[data-v-c586d1c0]{background:#000;opacity:0;position:absolute;display:none;top:0;left:0;width:0;height:0;cursor:move;z-index:2;box-sizing:border-box}.crop-box.show[data-v-c586d1c0]{display:block}.drag-point[data-v-c586d1c0]{display:inline-block;width:10px;height:10px;position:absolute;box-sizing:border-box}.point-lt[data-v-c586d1c0]{top:-4px;left:-4px;cursor:nw-resize}.point-lb[data-v-c586d1c0]{left:-4px;bottom:-4px;cursor:sw-resize}.point-rt[data-v-c586d1c0]{right:-4px;top:-4px;cursor:ne-resize}.point-rb[data-v-c586d1c0]{right:-4px;bottom:-4px;cursor:se-resize}.point-t[data-v-c586d1c0]{top:-4px;left:6px;cursor:n-resize}.point-b[data-v-c586d1c0]{bottom:-4px;left:6px;cursor:s-resize}.point-l[data-v-c586d1c0]{left:-4px;top:6px;cursor:w-resize}.point-r[data-v-c586d1c0]{right:-4px;top:6px;cursor:e-resize}.shadow-box[data-v-c586d1c0]{overflow:hidden;z-index:1}.shadow-box[data-v-c586d1c0],.shadow-img[data-v-c586d1c0]{position:absolute;top:0;left:0}.shadow-box[data-v-c586d1c0]::-moz-selection,.shadow-img[data-v-c586d1c0]::-moz-selection{background-color:transparent}.shadow-box[data-v-c586d1c0]::selection,.shadow-img[data-v-c586d1c0]::selection{background-color:transparent}',""])},function(t,e){function i(t,e){var i=t[1]||"",o=t[3];if(!o)return i;if(e&&"function"==typeof btoa){var s=r(o);return[i].concat(o.sources.map(function(t){return"/*# sourceURL="+o.sourceRoot+t+" */"})).concat([s]).join("\n")}return[i].join("\n")}function r(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var r=i(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r}).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},o=0;o<this.length;o++){var s=this[o][0];"number"==typeof s&&(r[s]=!0)}for(o=0;o<t.length;o++){var n=t[o];"number"==typeof n[0]&&r[n[0]]||(i&&!n[2]?n[2]=i:i&&(n[2]="("+n[2]+") and ("+i+")"),e.push(n))}},e}},function(t,e,i){function r(t){for(var e=0;e<t.length;e++){var i=t[e],r=d[i.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](i.parts[o]);for(;o<i.parts.length;o++)r.parts.push(s(i.parts[o]));r.parts.length>i.parts.length&&(r.parts.length=i.parts.length)}else{for(var n=[],o=0;o<i.parts.length;o++)n.push(s(i.parts[o]));d[i.id]={id:i.id,refs:1,parts:n}}}}function o(){var t=document.createElement("style");return t.type="text/css",l.appendChild(t),t}function s(t){var e,i,r=document.querySelector("style["+x+'~="'+t.id+'"]');if(r){if(u)return g;r.parentNode.removeChild(r)}if(m){var s=p++;r=f||(f=o()),e=n.bind(null,r,s,!1),i=n.bind(null,r,s,!0)}else r=o(),e=a.bind(null,r),i=function(){r.parentNode.removeChild(r)};return e(t),function(r){if(r){if(r.css===t.css&&r.media===t.media&&r.sourceMap===t.sourceMap)return;e(t=r)}else i()}}function n(t,e,i,r){var o=i?"":r.css;if(t.styleSheet)t.styleSheet.cssText=w(e,o);else{var s=document.createTextNode(o),n=t.childNodes;n[e]&&t.removeChild(n[e]),n.length?t.insertBefore(s,n[e]):t.appendChild(s)}}function a(t,e){var i=e.css,r=e.media,o=e.sourceMap;if(r&&t.setAttribute("media",r),v.ssrId&&t.setAttribute(x,e.id),o&&(i+="\n/*# sourceURL="+o.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var c="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!c)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var h=i(7),d={},l=c&&(document.head||document.getElementsByTagName("head")[0]),f=null,p=0,u=!1,g=function(){},v=null,x="data-vue-ssr-id",m="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());t.exports=function(t,e,i,o){u=i,v=o||{};var s=h(t,e);return r(s),function(e){for(var i=[],o=0;o<s.length;o++){var n=s[o],a=d[n.id];a.refs--,i.push(a)}e?(s=h(t,e),r(s)):s=[];for(var o=0;o<i.length;o++){var a=i[o];if(0===a.refs){for(var c=0;c<a.parts.length;c++)a.parts[c]();delete d[a.id]}}}};var w=function(){var t=[];return function(e,i){return t[e]=i,t.filter(Boolean).join("\n")}}()},function(t,e){t.exports=function(t,e){for(var i=[],r={},o=0;o<e.length;o++){var s=e[o],n=s[0],a=s[1],c=s[2],h=s[3],d={id:t+":"+o,css:a,media:c,sourceMap:h};r[n]?r[n].parts.push(d):i.push(r[n]={id:n,parts:[d]})}return i}},function(t,e){t.exports=function(t,e,i,r,o,s){var n,a=t=t||{},c=typeof t.default;"object"!==c&&"function"!==c||(n=t,a=t.default);var h="function"==typeof a?a.options:a;e&&(h.render=e.render,h.staticRenderFns=e.staticRenderFns,h._compiled=!0),i&&(h.functional=!0),o&&(h._scopeId=o);var d;if(s?(d=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},h._ssrRegister=d):r&&(d=r),d){var l=h.functional,f=l?h.render:h.beforeCreate;l?(h._injectStyles=d,h.render=function(t,e){return d.call(e),f(t,e)}):h.beforeCreate=f?[].concat(f,d):[d]}return{esModule:n,exports:a,options:h}}},function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cropper-modal"},[i("div",{staticClass:"overlay"}),t._v(" "),i("div",{staticClass:"modal"},[i("div",{staticClass:"modal-content clearfix"},[i("div",{staticClass:"img-clip-wrap"},[i("div",{staticClass:"container-bg"},[i("div",{staticClass:"img-container"},[i("img",{attrs:{id:"clip_src_img",src:t.img},on:{load:t.srcImgLoaded}}),t._v(" "),i("div",{staticClass:"shadow-box"}),t._v(" "),i("div",{ref:"box",staticClass:"crop-wrap"},[i("div",{staticClass:"shadow-box",style:t.recStyle},[i("img",{staticClass:"shadow-img",style:t.imgStyle,attrs:{src:t.img}})]),t._v(" "),i("div",{staticClass:"crop-box",class:t.showBox?"show":"",style:t.recStyle,on:{mousedown:t.boxMouseDown}},[i("span",{staticClass:"drag-point point-lt",on:{mousedown:function(e){t.pointMouseDown("drag-lt",e)}}}),t._v(" "),i("span",{staticClass:"drag-point point-lb",on:{mousedown:function(e){t.pointMouseDown("drag-lb",e)}}}),t._v(" "),i("span",{staticClass:"drag-point point-rt",on:{mousedown:function(e){t.pointMouseDown("drag-rt",e)}}}),t._v(" "),i("span",{staticClass:"drag-point point-rb",on:{mousedown:function(e){t.pointMouseDown("drag-rb",e)}}}),t._v(" "),i("span",{staticClass:"drag-point point-t",style:t.leftStyle,on:{mousedown:function(e){t.pointMouseDown("drag-t",e)}}}),t._v(" "),i("span",{staticClass:"drag-point point-b",style:t.leftStyle,on:{mousedown:function(e){t.pointMouseDown("drag-b",e)}}}),t._v(" "),i("span",{staticClass:"drag-point point-l",style:t.rightStyle,on:{mousedown:function(e){t.pointMouseDown("drag-l",e)}}}),t._v(" "),i("span",{staticClass:"drag-point point-r",style:t.rightStyle,on:{mousedown:function(e){t.pointMouseDown("drag-r",e)}}})])])])]),t._v(" "),i("div",{staticClass:"reset-img"},[i("i",{staticClass:"icon-reset"}),t._v(" "),i("span",[t._v("选择图片")]),t._v(" "),i("input",{attrs:{type:"file",id:"file_input",accept:"image/png,image/jpg,image/gif"},on:{change:t.fileChange}})])]),t._v(" "),i("div",{staticClass:"img-preview-wrap"},[i("div",{staticClass:"pre-container"},[i("img",{attrs:{id:"clip_res_img",src:t.img}})])]),t._v(" "),i("div",{staticClass:"img-preview-wrap"},[i("span",[t._v("上传结果：")]),t._v(" "),i("div",{staticClass:"pre-container"},[i("img",{attrs:{src:t.clipData}})])])]),t._v(" "),i("div",{staticClass:"modal-footer"},[i("a",{staticClass:"modal-btn btn-confirm",on:{click:t.clip}},[t._v("上传")])])])])},o=[],s={render:r,staticRenderFns:o};e.a=s}])});
//# sourceMappingURL=cut_img.js.map